#!/bin/bash

# Pre-commit hook to prevent committing sensitive files
# Copy this file to .git/hooks/pre-commit and make it executable

echo "üîç Running pre-commit checks..."

# Check for sensitive files
SENSITIVE_FILES=(
    ".env"
    "config/config.php"
    "config/email.php"
    "config/db.php"
    "*.log"
    "*.sql"
)

for pattern in "${SENSITIVE_FILES[@]}"; do
    if git diff --cached --name-only | grep -q "$pattern"; then
        echo "‚ùå ERROR: Attempting to commit sensitive file matching: $pattern"
        echo "   This file should be in .gitignore"
        exit 1
    fi
done

# Check for debug statements
if git diff --cached --name-only | grep -E '\.php$' | xargs grep -n "var_dump\|print_r\|dd(" 2>/dev/null; then
    echo "‚ö†Ô∏è  WARNING: Debug statements found in PHP files"
    read -p "Continue anyway? (y/N) " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

echo "‚úÖ Pre-commit checks passed!"
exit 0
